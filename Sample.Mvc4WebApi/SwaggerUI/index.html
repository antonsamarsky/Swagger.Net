<html>
<head>
    <title>Swagger UI</title>
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet'
        type='text/css' />
    <link href='css/screen.css' media='screen' rel='stylesheet' type='text/css' />
    <script src='lib/jquery.min.js' type='text/javascript'></script>
    <script src='lib/jquery.slideto.min.js' type='text/javascript'></script>
    <script src='lib/jquery.wiggle.min.js' type='text/javascript'></script>
    <script src='lib/jquery.ba-bbq.min.js' type='text/javascript'></script>
    <script src='lib/handlebars.runtime-1.0.0.beta.6.js' type='text/javascript'></script>
    <script src='lib/underscore-min.js' type='text/javascript'></script>
    <script src='lib/backbone-min.js' type='text/javascript'></script>
    <script src='lib/swagger.js' type='text/javascript'></script>
    <script src='swagger-ui.js' type='text/javascript'></script>
    <style type="text/css">
        .swagger-ui-wrap
        {
            max-width: 960px;
            margin-left: auto;
            margin-right: auto;
        }
        .icon-btn
        {
            cursor: pointer;
        }
        #message-bar
        {
            min-height: 30px;
            text-align: center;
            padding-top: 10px;
        }
        .message-success
        {
            color: #89BF04;
        }
        .message-fail
        {
            color: #cc0000;
        }
        #oauth-creds-form label
        {
            width: 150px;
            display: inline-block;
        }
        #oauth-creds-form input
        {
            width: 230px;
            display: inline-block;
            font-size: 10px;
            padding: 2px;
            margin: 2px;
        }
    </style>
    <script type="text/javascript">
        $(function () {
            // /api/swagger
            window.swaggerUi = new SwaggerUi({
                discoveryUrl: "https://api.pps.io/v1/api/docs/payment",
                apiKey: "",
                dom_id: "swagger-ui-container",
                supportHeaderParams: false,
                supportedSubmitMethods: ['get', 'post', 'put']
            });

            window.swaggerUi.load();
        });
    </script>
</head>
<body>
    <div id='header'>
        <div class="swagger-ui-wrap">
            <a id="logo" href="http://swagger.wordnik.com">swagger</a>
            <form id='api_selector'>
            <div class='input icon-btn'>
                <img id="show-pet-store-icon" src="images/pet_store_api.png" title="Show Swagger Petstore Example Apis">
            </div>
            <div class='input icon-btn'>
                <img id="show-wordnik-dev-icon" src="images/wordnik_api.png" title="Show Wordnik Developer Apis">
            </div>
            <div class='input'>
                <input placeholder="http://example.com/api" id="input_baseUrl" name="baseUrl" type="text" /></div>
            <div class='input'>
                <input placeholder="api_key" id="input_apiKey" name="apiKey" type="text" /></div>
            <div class='input'>
                <a id="explore" href="#">Explore</a></div>
            </form>
        </div>
    </div>
    <div id="message-bar" class="swagger-ui-wrap">
        &nbsp;
    </div>
    <div id="oauth-creds" class="swagger-ui-wrap">
        <form id='oauth-creds-form'>
        <div style="width: 43%; display: inline-block">
            <div class='input'>
                <label>
                    Consumer Key</label>
                <input placeholder="consumer_key" id="consumer_key" name="consumer_key" type="text" />
            </div>
            <div class='input'>
                <label>
                    Consumer Secret</label>
                <input placeholder="consumer_secret" id="consumer_secret" name="consumer_secret"
                    type="text" />
            </div>
        </div>
        <div style="width: 45%; display: inline-block">
            <div class='input'>
                <label>
                    Access Token</label>
                <input placeholder="access_token" id="access_token" name="access_token" type="text" />
            </div>
            <div class='input'>
                <label>
                    Access Token Secret</label>
                <input placeholder="access_token_secret" id="access_token_secret" name="access_token_secret"
                    type="text" />
            </div>
        </div>
        <button id="btn_fetch_access">
            Refresh Access Token</button>
        </form>
    </div>
    <div id="swagger-ui-container" class="swagger-ui-wrap">
    </div>
    <script src='app_config.js' type='text/javascript'></script>
    <script src='lib/jsOAuth-1.3.6.js' type='text/javascript'></script>
    <script type="text/javascript">

        $(function () {
            // https://api.pps.io/v1/pci
            // var merchId = "100001322";

            // Config loaded from app_config.js
            var config = window.APP.config;


            var oauth = OAuth({
                consumerKey: config.consumerKey,
                consumerSecret: config.consumerSecret,
                accessTokenUrl: config.accessTokenUrl,
                requestTokenUrl: config.requestTokenUrl
            });

            // display consumer key and secret
            $('#consumer_key').val(config.consumerKey);
            $('#consumer_secret').val(config.consumerSecret);



            $('#btn_fetch_access').click(function (ev) {
                ev.preventDefault();

                var displayAccesToken = function (data) {

                    var key = data.text.split("&")[0];
                    key = key.substring(key.indexOf('=') + 1);

                    var secret = data.text.split("&")[1];
                    secret = secret.substring(secret.indexOf('=') + 1);

                    $('#access_token').val(key);
                    $('#access_token_secret').val(secret);

                    console.log(JSON.stringify(data));

                    oauth.setAccessToken(key, secret);
                    $.ajax = function (options) {
                        console.log(options);
                        oauth.request(options);
                        console.log("ajax2");

                    };
                };

                // todo: grab key and secret from textboxes.

                oauth.fetchAccessToken(displayAccesToken, function (err) {
                    console.log(JSON.stringify(err));
                });
            });
        });

    </script>
</body>
</html>
